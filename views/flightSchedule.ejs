<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

   <!-- Bootstrap CSS -->
   <!-- build:css css/main.css -->
   <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
   <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">
   <link rel="stylesheet" href="node_modules/bootstrap-social/bootstrap-social.css">
   <link rel="stylesheet" href="css/styles.css">
   <!-- endbuild -->
   <title>Flight Schedule</title>
</head>
<body>

    <h1><em>FLIGHT SCHEDULE:</em></h1>

    <%
    sortByDate = function sortByDate(arr) {
        arr.sort(function(a, b){
                return new Date(a.FlightDate) - new Date(b.FlightDate);
            
        }); 
    } %>


  <% sortByDate(flights); %>

  <% for(i = 0;i < flights.length-1; i++){
      if(+flights[i].FlightDate==+flights[i+1].FlightDate){ 
        var h1,h2=0; 
        if(flights[i].Departure.Period=='PM' && flights[i].Departure.Hours!=12){
            h1= flights[i].Departure.Hours+12;
        }
        else{
            h1=flights[i].Departure.Hours;
        }
        
        if(flights[i+1].Departure.Period=='PM' && flights[i+1].Departure.Hours!=12){
            h2= flights[i+1].Departure.Hours+12;
        }
        else{
            h2=flights[i+1].Departure.Hours;
        }

        var d1 = new Date(flights[i].FlightDate.getFullYear(), flights[i].FlightDate.getMonth(), flights[i].FlightDate.getDate(), h1,flights[i].Departure.Minutes);
        var d2 = new Date(flights[i+1].FlightDate.getFullYear(), flights[i+1].FlightDate.getMonth(), flights[i+1].FlightDate.getDate(), h2,flights[i+1].Departure.Minutes);

        if (d1>d2){
            var temp = flights[i];
            flights[i] = flights[i+1];
            flights[i+1] = temp;
        }

      }                  
   } %>

        <ol>
            <% for(i = 0;i < flights.length; i++) { %>
                <li> 

                    <ul>
                        <li>ID: <%= flights[i]._id %> 
    
                        <li>Number:  <%= flights[i].FlightNumber %>
    
                        <li>Departure:  <%= flights[i].Departure.Hours %>:<%= flights[i].Departure.Minutes %> <%= flights[i].Departure.Period %> 
    
                        <li>Arrival: <%= flights[i].Arrival.Hours %>:<%= flights[i].Arrival.Minutes %> <%= flights[i].Arrival.Period %> 
    
                        <li>Date: <%= flights[i].FlightDate.getDate() %>/<%= flights[i].FlightDate.getMonth() + 1%>/<%= flights[i].FlightDate.getFullYear() %>
                    </ul>
    
                </li>
                
                <hr>

            <% } %>
           
        </ol>

</body>
</html>